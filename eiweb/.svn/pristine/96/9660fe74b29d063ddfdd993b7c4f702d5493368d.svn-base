<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="skt.eiweb.code.mapper.CommonCodeMapper">

    <select id="selectCommonCodeList" parameterType="skt.eiweb.code.model.CommonCodeDto" resultType="skt.eiweb.code.model.CommonCodeDto">
      SELECT GRP.GROUP_CODE, GRP.GROUP_NAME, CD.CODE, CD.VALUE, CD.CODE_NAME, SORT, CD.USE_YN
		    FROM COMMON_GROUP GRP, COMMON_CODE CD
		   WHERE GRP.GROUP_CODE = CD.GROUP_CODE 
		    <if test="allFlag == null">
			    AND GRP.GROUP_CODE != 'INIT_ADMIN_INFO'
		    </if>
		    <if test="groupUseYn != null">
			    AND GRP.USE_YN=#{groupUseYn}
		    </if>
		    <if test="useYn != null">
          AND CD.USE_YN=#{useYn}
        </if>
        <if test="groupCode != null">
          AND GRP.GROUP_CODE = #{groupCode}
        </if>
        <if test="code != null">
          AND CD.CODE = #{code}
        </if>
       ORDER BY GRP.GROUP_CODE, SORT
    </select>
    
    <select id="selectCommonCode" parameterType="skt.eiweb.code.model.CommonCodeDto" resultType="skt.eiweb.code.model.CommonCodeDto">
      SELECT GRP.GROUP_CODE, GRP.GROUP_NAME, CD.CODE, CD.VALUE, CD.CODE_NAME, SORT
		    FROM COMMON_GROUP GRP, COMMON_CODE CD
		   WHERE GRP.GROUP_CODE = CD.GROUP_CODE
         AND GRP.USE_YN='Y' 
         AND CD.USE_YN='Y'
         AND GRP.GROUP_CODE=#{groupCode} 
         AND CD.CODE = #{code}
    </select>
    
    <select id="selectCodesByGroupCode" parameterType="skt.eiweb.code.model.CommonCodeDto" resultType="skt.eiweb.code.model.CommonCodeDto">
      SELECT GRP.GROUP_CODE, GRP.GROUP_NAME, CD.CODE, CD.VALUE, CD.CODE_NAME, SORT
		    FROM COMMON_GROUP GRP, COMMON_CODE CD
		   WHERE GRP.GROUP_CODE = CD.GROUP_CODE
         AND GRP.USE_YN='Y' 
         AND CD.USE_YN='Y'
			   AND GRP.GROUP_CODE=#{groupCode}
    </select>
    
    <select id="selectCommonGroupList" parameterType="skt.eiweb.code.model.CommonCodeDto" resultType="skt.eiweb.code.model.CommonCodeDto">
      SELECT GROUP_CODE, GROUP_NAME, USE_YN 
        FROM COMMON_GROUP
			 WHERE 1=1 
        <if test="groupCode != null">
          AND GROUP_CODE = #{groupCode}
        </if>
        <if test="groupUseYn != null">
          AND USE_YN=#{groupUseYn} 
        </if>
       ORDER BY GROUP_CODE
    </select>
    
    <insert id="insertCodeGroup" parameterType="skt.eiweb.code.model.CommonCodeDto">
      INSERT INTO COMMON_GROUP 
             (GROUP_CODE, GROUP_NAME, USE_YN) 
      VALUES (#{groupCode}, #{groupName}, #{groupUseYn} )
    </insert>
    
    <update id="updateCodeGroup" parameterType="skt.eiweb.code.model.CommonCodeDto">
      UPDATE COMMON_GROUP 
         SET GROUP_CODE=GROUP_CODE
          <if test="groupName != null">
            ,GROUP_NAME=#{groupName}
          </if>
          <if test="groupUseYn != null">
            ,USE_YN=#{groupUseYn}
          </if>
    	 WHERE GROUP_CODE=#{groupCode}
    </update>
    
    <insert id="insertCode" parameterType="skt.eiweb.code.model.CommonCodeDto">
      INSERT INTO common_code 
             (GROUP_CODE, CODE, VALUE, USE_YN, SORT, CODE_NAME)
			VALUES (#{groupCode}, #{code}, #{value}, #{useYn},
        <if test="sort != null">#{sort}</if>
        <if test="sort == null">(SELECT CNT FROM (SELECT COUNT(*)+1 CNT FROM COMMON_CODE WHERE GROUP_CODE=#{groupCode}) a )</if>
			    ,#{codeName} )
    </insert>
    
    <update id="updateCode" parameterType="skt.eiweb.code.model.CommonCodeDto">
      UPDATE common_code 
         SET CODE=CODE
          <if test="value != null">
            ,VALUE=#{value}
          </if>
          <if test="useYn != null">
            ,USE_YN=#{useYn}
          </if>
          <if test="sort != null">
            ,SORT=#{sort}
          </if>
          <if test="codeName != null">
            ,CODE_NAME=#{codeName}
          </if>
    		WHERE GROUP_CODE=#{groupCode} and CODE=#{code}
    </update>
    
    <delete id="deleteCodeGroup" parameterType="skt.eiweb.code.model.CommonCodeDto">
      DELETE FROM COMMON_GROUP 
       WHERE GROUP_CODE=#{groupCode}
    </delete>
    
    <delete id="deleteCode" parameterType="skt.eiweb.code.model.CommonCodeDto">
      DELETE FROM COMMON_CODE 
       WHERE GROUP_CODE=#{groupCode}
        <if test="code != null">
          AND CODE=#{code}
        </if>
    </delete>
    
</mapper>
